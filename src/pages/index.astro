---
import type { CollectionEntry } from "astro:content";
import { Icon } from "astro-icon/components";
import CategoryCard from "../components/CategoryCard.astro";
import DailyPaperWidget from "../components/DailyPaperWidget.svelte";
import GridPostCard from "../components/GridPostCard.astro";
import I18nKey from "../i18n/i18nKey";
import { i18n } from "../i18n/translation";
import HomeLayout from "../layouts/HomeLayout.astro";
import { getCategoryList, getSortedPosts } from "../utils/content-utils";
import { getPostUrlBySlug } from "../utils/url-utils";

const categories = await getCategoryList();
const sortedPosts = await getSortedPosts();
const latestPosts = sortedPosts.slice(0, 4);

// Series Logic
const seriesMap = new Map();
sortedPosts.forEach((post) => {
	if (post.data.series) {
		if (!seriesMap.has(post.data.series)) {
			seriesMap.set(post.data.series, []);
		}
		seriesMap.get(post.data.series).push(post);
	}
});

const allSeries = Array.from(seriesMap.entries()).map(([name, posts]) => {
	// Sort by seriesOrder
	posts.sort(
		(a: CollectionEntry<"posts">, b: CollectionEntry<"posts">) =>
			(a.data.seriesOrder || 999) - (b.data.seriesOrder || 999),
	);
	return {
		name,
		posts,
		count: posts.length,
		image: posts[0].data.image,
	};
});

// Placeholder image URL - replace with actual image
const bgImage = "/images/hero-bg.gif";
---

<HomeLayout title={i18n(I18nKey.home)} description={i18n(I18nKey.home)}>
    <div class="relative w-full h-screen flex items-center justify-center overflow-hidden">
        <!-- Background Image -->
        <div class="absolute inset-0 z-0">
            <img src={bgImage} alt="Background" class="w-full h-full object-cover" />
            <div class="absolute inset-0 bg-black/50"></div> <!-- Overlay -->
        </div>

        <!-- Content -->
        <div class="relative z-10 text-center flex flex-col items-center gap-6 px-4">
            <!-- Pill Label -->
            <div class="inline-block px-6 py-2 rounded-full border border-white/30 bg-white/10 backdrop-blur-md text-white font-bold uppercase tracking-wider text-sm shadow-lg">
                I LOVE WHAT I DO
            </div>

            <!-- Main Heading -->
            <h1 class="text-6xl md:text-8xl font-bold text-white tracking-tight">
                Hello World !
            </h1>

            <!-- Sub Heading -->
            <!-- Sub Heading -->
            <div class="text-4xl md:text-6xl font-bold text-white">
                Let's Start with <span id="typing-text" class="text-[var(--primary)]">Web Dev</span>
            </div>

            <script>
                const words = ["Python", "C++", "C", "Java", "R", "Html", "React", "Astro", "PHP"];
                let wordIndex = 0;
                let charIndex = 0;
                let isDeleting = false;
                const typingSpeed = 150;
                const deletingSpeed = 100;
                const pauseDuration = 2000;

                function typeEffect() {
                    const heading = document.getElementById("typing-text");
                    if (!heading) return;

                    const currentWord = words[wordIndex];

                    if (isDeleting) {
                        heading.textContent = currentWord.substring(0, charIndex - 1);
                        charIndex--;
                    } else {
                        heading.textContent = currentWord.substring(0, charIndex + 1);
                        charIndex++;
                    }

                    let nextSpeed = isDeleting ? deletingSpeed : typingSpeed;

                    if (!isDeleting && charIndex === currentWord.length) {
                        isDeleting = true;
                        nextSpeed = pauseDuration;
                    } else if (isDeleting && charIndex === 0) {
                        isDeleting = false;
                        wordIndex = (wordIndex + 1) % words.length;
                        nextSpeed = 500;
                    }

                    setTimeout(typeEffect, nextSpeed);
                }


                typeEffect();

                // Dashboard Logic

            </script>

            <!-- Quote -->
            <div class="mt-12 flex flex-col items-center gap-4 max-w-2xl">
                <div class="text-white/80 text-4xl">‚ùù</div>
                <p class="text-white/90 text-lg md:text-xl font-medium leading-relaxed">
                    ÎßåÎÇòÏÑú Î∞òÍ∞ÄÏõå! ÎÇòÏóêÍ≤å ÌîÑÎ°úÍ∑∏ÎûòÎ∞ç ÏÑ∏ÏÉÅÏùÑ Î≥¥Ïó¨Ï§òÏÑú Í≥†ÎßàÏõå
                </p>
            </div>
        </div>

        <!-- Scroll Indicator (Optional, based on common patterns) -->
        <div class="absolute bottom-10 left-1/2 -translate-x-1/2 animate-bounce">
            <div class="w-6 h-10 border-2 border-white/50 rounded-full flex justify-center pt-2">
                <div class="w-1 h-2 bg-white/50 rounded-full"></div>
            </div>
        </div>
    </div>





    <!-- Category Section (Hidden) -->
    <!-- 
    <div class="max-w-[var(--page-width)] mx-auto px-4 py-8 mt-8">
        <div class="text-center mb-8">
            <h2 class="text-3xl font-bold text-black/75 dark:text-white/75 mb-2">Popular Categories üëë</h2>
            <p class="text-black/50 dark:text-white/50">Explore our diverse range of topics</p>
        </div>
        
        <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">
            {categories.map((category, index) => {
                const lowerName = category.name.toLowerCase();
                let icon = "material-symbols:folder-open-outline"; // Default icon

                if (lowerName.includes("devops") || lowerName.includes("aws")) {
                    icon = "fa6-brands:aws";
                } else if (lowerName.includes("linux")) {
                    icon = "fa6-brands:linux";
                } else if (lowerName.includes("typescript") || lowerName.includes("js")) {
                    icon = "material-symbols:javascript";
                } else if (lowerName.includes("python")) {
                    icon = "fa6-brands:python";
                } else if (lowerName.includes("react")) {
                    icon = "fa6-brands:react";
                } else if (lowerName.includes("git")) {
                    icon = "fa6-brands:git-alt";
                } else if (lowerName.includes("web") || lowerName.includes("frontend")) {
                    icon = "material-symbols:html";
                } else if (lowerName.includes("css")) {
                    icon = "fa6-brands:css3-alt";
                } else if (lowerName.includes("archive")) {
                     icon = "material-symbols:archive-outline";
                } else if (lowerName.includes("uncategorized")) {
                     icon = "material-symbols:category-outline";
                } else if (lowerName.includes("deepl") || lowerName.includes("ai") || lowerName.includes("llm")) {
                    icon = "material-symbols:robot-2-outline";
                } else if (lowerName.includes("nlp")) {
                    icon = "material-symbols:translate";
                } else if (lowerName.includes("paper")) {
                    icon = "material-symbols:article-outline";
                } else if (lowerName.includes("study") || lowerName.includes("algo")) {
                    icon = "material-symbols:menu-book-outline";
                }

                return (
                    <CategoryCard 
                        name={category.name} 
                        count={category.count} 
                        url={category.url} 
                        icon={icon}
                        index={index}
                    />
                );
            })}
        </div>
    </div>
    -->


    <!-- Recent Engineering Logs Section -->
    <div class="max-w-[var(--page-width)] mx-auto px-4 pt-8 pb-4 mb-4">
        <div class="flex justify-between items-end mb-6 section-header opacity-0 translate-y-8 transition duration-700 ease-out">
            <div class="text-left">
                <h2 class="text-3xl font-bold text-black/75 dark:text-white/75 mb-2">üìù Recent Engineering Logs</h2>
                <p class="text-black/50 dark:text-white/50">Sharing my learning journey and technical insights.</p>
            </div>
            <a href="/posts/" class="text-[var(--primary)] hover:text-[var(--primary-hover)] font-medium transition flex items-center gap-1 mb-1">
                View All <Icon name="material-symbols:arrow-forward-rounded" class="text-xl" />
            </a>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
             {latestPosts.slice(0, 3).map((entry) => (
                <GridPostCard
                    entry={entry}
                    title={entry.data.title}
                    tags={entry.data.tags}
                    category={entry.data.category}
                    published={entry.data.published}
                    url={getPostUrlBySlug(entry.slug)}
                    image={entry.data.image}
                    description={entry.data.description}
                    class="h-full recent-post-card opacity-0 translate-y-8 transition duration-700 ease-out"
                />
            ))}
        </div>
    </div>

    <!-- Series Section -->
    <div class="max-w-[var(--page-width)] mx-auto px-4 pt-4 pb-8 mb-4">
         <div class="text-left mb-6 section-header opacity-0 translate-y-8 transition duration-700 ease-out">
            <h2 class="text-3xl font-bold text-black/75 dark:text-white/75 mb-2">Featured Series üìö</h2>
            <p class="text-black/50 dark:text-white/50">Curated collections of related posts.</p>
        </div>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            {allSeries.map(series => (
                 <a href={getPostUrlBySlug(series.posts[0].slug)} class="group relative overflow-hidden rounded-xl bg-white dark:bg-[#1e1e1e] shadow-lg border border-black/5 dark:border-white/5 h-64 flex flex-col justify-end section-header opacity-0 translate-y-8 transition duration-700 ease-out">
                     {/* Background Image */}
                     <div class="absolute inset-0 z-0">
                        <img src={series.image} alt={series.name} class="w-full h-full object-cover transition duration-700 group-hover:scale-110" />
                        <div class="absolute inset-0 bg-gradient-to-t from-black/80 to-transparent"></div>
                     </div>
                     
                     {/* Content */}
                     <div class="relative z-10 p-6">
                        <div class="inline-flex items-center gap-1 px-3 py-1 rounded-full bg-[var(--primary)] text-white text-xs font-bold mb-2 shadow-md">
                             <Icon name="material-symbols:playlist-play-rounded" class="text-lg" />
                             {series.count} Posts
                        </div>
                        <h3 class="text-2xl font-bold text-white mb-1 group-hover:text-[var(--primary)] transition">{series.name}</h3>
                     </div>
                 </a>
            ))}
        </div>
    </div>

    <!-- Paper of the Day Section -->
    <div class="max-w-[var(--page-width)] mx-auto px-4 pt-4 pb-8 mb-16">
        <div class="text-left mb-6 section-header opacity-0 translate-y-8 transition duration-700 ease-out">
            <h2 class="text-3xl font-bold text-black/75 dark:text-white/75 mb-2">üìÑ Paper of the Day</h2>
            <p class="text-black/50 dark:text-white/50">Staying updated with the latest research.</p>
        </div>
        <div class="daily-paper-widget opacity-0 translate-y-8 transition duration-700 ease-out">
            <DailyPaperWidget client:visible />
        </div>
    </div>

    <script>
        const observerOptions = {
            root: null,
            rootMargin: '0px',
            threshold: 0.1
        };

        const observer = new IntersectionObserver((entries) => {
            entries.forEach((entry, index) => {
                if (entry.isIntersecting) {
                    setTimeout(() => {
                        entry.target.classList.remove('opacity-0', 'translate-y-8');
                    }, index * 100); // Staggered delay
                    observer.unobserve(entry.target);
                }
            });
        }, observerOptions);

        document.querySelectorAll('.project-card, .skill-card, .section-header, .timeline-item, .recent-post-card, .daily-paper-widget').forEach((card) => {
            observer.observe(card);
        });
    </script>
</HomeLayout>
