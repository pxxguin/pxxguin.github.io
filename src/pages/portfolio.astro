---
import Layout from "../layouts/Layout.astro";
import { profileConfig } from "../config";
import { skills } from "../data/skills";
import { projects } from "../data/projects";
import { Icon } from "astro-icon/components";
import { url } from "../utils/url-utils";
import Footer from "../components/Footer.astro";

const title = "Portfolio";
const description = "My Portfolio - Skills, Projects, and Story";
---

<Layout title={title} description={description}>
    <div class="bg-black text-white min-h-screen font-sans selection:bg-[var(--primary)] selection:text-white overflow-x-hidden">
        


        <!-- Hero Section -->
        <section class="min-h-screen flex flex-col justify-center px-6 md:px-20 relative overflow-hidden">
            <div class="absolute inset-0 bg-[radial-gradient(circle_at_top_right,_var(--primary)_0%,_transparent_40%)] opacity-20 pointer-events-none z-10"></div>
            
            <div class="max-w-5xl z-20">
                <h1 class="text-6xl md:text-8xl lg:text-9xl font-black tracking-tighter leading-[0.9] mb-8 animate-fade-in-up">
                    I BUILD <br />
                    <span class="text-transparent bg-clip-text bg-gradient-to-r from-white to-white/50" id="typing-text">SCALABLE</span><span class="animate-blink text-white/50">|</span> <br />
                    SYSTEMS.
                </h1>
                <p class="text-xl md:text-2xl text-white/60 max-w-2xl leading-relaxed mb-12 animate-fade-in-up delay-100">
                    ì•ˆë…•í•˜ì„¸ìš”, ë°ì´í„°ì™€ ëª¨ë¸ì„ ì‡ëŠ” MLOps ì—”ì§€ë‹ˆì–´ <span class="text-white font-bold">{profileConfig.name}</span>ì…ë‹ˆë‹¤. <br />
                    ì•ˆì •ì ì´ê³  íš¨ìœ¨ì ì¸ ë¨¸ì‹ ëŸ¬ë‹ íŒŒì´í”„ë¼ì¸ì„ êµ¬ì¶•í•˜ì—¬ ë¹„ì¦ˆë‹ˆìŠ¤ ê°€ì¹˜ë¥¼ ì°½ì¶œí•©ë‹ˆë‹¤.
                </p>
                <div class="flex gap-6 animate-fade-in-up delay-200">
                    <a href="#projects" class="px-8 py-4 bg-white text-black font-bold rounded-full hover:scale-105 transition duration-300">
                        View Projects
                    </a>
                    <a href="#contact" class="px-8 py-4 border border-white/20 text-white font-bold rounded-full hover:bg-white/10 transition duration-300">
                        Contact Me
                    </a>
                </div>
            </div>

            <div class="absolute bottom-10 left-6 md:left-20 animate-bounce">
                <Icon name="material-symbols:arrow-downward" class="text-3xl text-white/50" />
            </div>
        </section>

        <!-- About Section -->
        <section id="about" class="py-32 px-6 md:px-20 border-t border-white/10 bg-[#050505]">
            <div class="max-w-6xl mx-auto grid grid-cols-1 md:grid-cols-2 gap-16 items-center">
                <div>
                    <h2 class="text-sm font-bold tracking-widest text-[var(--primary)] mb-4 uppercase">My Story</h2>
                    <h3 class="text-4xl md:text-5xl font-bold leading-tight mb-8">
                        From Model <br /> to <span class="text-[var(--primary)]">Production</span>.
                    </h3>
                </div>
                <div class="text-lg text-white/70 leading-relaxed space-y-6">
                    <p>
                        ë‹¨ìˆœíˆ ëª¨ë¸ì„ ë§Œë“œëŠ” ê²ƒì„ ë„˜ì–´, ëª¨ë¸ì´ ì‹¤ì œ í™˜ê²½ì—ì„œ ì‚´ì•„ìˆ¨ì‰¬ê²Œ ë§Œë“œëŠ” ê²ƒì— ì—´ì •ì„ ëŠë‚ë‹ˆë‹¤.
                        ì‹¤í—˜ì‹¤ì˜ ëª¨ë¸ì„ ì•ˆì •ì ì¸ ì„œë¹„ìŠ¤ë¡œ ì—°ê²°í•˜ê³ , ì§€ì† ê°€ëŠ¥í•œ í•™ìŠµ íŒŒì´í”„ë¼ì¸ì„ ì„¤ê³„í•©ë‹ˆë‹¤.
                    </p>
                    <p>
                        ë°ì´í„° ìˆ˜ì§‘ë¶€í„° ëª¨ë¸ ë°°í¬, ëª¨ë‹ˆí„°ë§ê¹Œì§€ì˜ ì „ ê³¼ì •ì„ ìë™í™”í•˜ì—¬
                        ê°œë°œìê°€ ë³¸ì§ˆì ì¸ ë¬¸ì œ í•´ê²°ì— ì§‘ì¤‘í•  ìˆ˜ ìˆëŠ” í™˜ê²½ì„ ë§Œë“­ë‹ˆë‹¤.
                        ëŠì„ì—†ì´ ë³€í™”í•˜ëŠ” AI ìƒíƒœê³„ ì†ì—ì„œë„ ê²¬ê³ í•˜ê³  í™•ì¥ ê°€ëŠ¥í•œ ì¸í”„ë¼ë¥¼ êµ¬ì¶•í•˜ëŠ” ê²ƒì´ ì €ì˜ ëª©í‘œì…ë‹ˆë‹¤.
                    </p>
                </div>
            </div>
        </section>



        <!-- Projects Section -->
        <section id="projects" class="py-32 px-6 md:px-20 border-t border-white/10 bg-[#050505]">
            <div class="max-w-7xl mx-auto">
                <h2 class="text-sm font-bold tracking-widest text-[var(--primary)] mb-4 uppercase">Selected Works</h2>
                <h3 class="text-4xl md:text-5xl font-bold mb-16">Featured Projects</h3>

                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                    {projects.map((project) => (
                        <div 
                            class="project-card-trigger group relative block rounded-3xl overflow-hidden aspect-[4/3] bg-white/5 cursor-pointer"
                            data-project={JSON.stringify(project)}
                        >
                            <img src={project.image} alt={project.title} class="absolute inset-0 w-full h-full object-cover transition duration-700 group-hover:scale-105 group-hover:opacity-40" />
                            <div class="absolute inset-0 bg-gradient-to-t from-black/90 via-black/50 to-transparent opacity-80 group-hover:opacity-100 transition duration-500"></div>
                            
                            <div class="absolute bottom-0 left-0 w-full p-8 translate-y-4 group-hover:translate-y-0 transition duration-500">
                                <h4 class="text-3xl font-bold mb-2">{project.title}</h4>
                                <p class="text-white/70 mb-4 line-clamp-2">{project.description}</p>
                                <div class="flex flex-wrap gap-2">
                                    {project.tags.map((tag) => (
                                        <span class="px-3 py-1 text-xs font-bold uppercase tracking-wider bg-white/10 rounded-full text-white/90">
                                            {tag}
                                        </span>
                                    ))}
                                </div>
                            </div>
                        </div>
                    ))}
                </div>
            </div>
        </section>

        <!-- Contact Section -->
        <section id="contact" class="py-32 px-6 md:px-20 border-t border-white/10 flex flex-col items-center text-center">
            <h2 class="text-5xl md:text-7xl font-black mb-8 tracking-tighter">
                LET'S WORK <br /> <span class="text-transparent bg-clip-text bg-gradient-to-r from-[var(--primary)] to-purple-500">TOGETHER</span>
            </h2>
            <p class="text-xl text-white/60 max-w-2xl mb-12">
                ìƒˆë¡œìš´ ë„ì „ì€ ì–¸ì œë‚˜ í™˜ì˜ì…ë‹ˆë‹¤. <br />
                í•¨ê»˜ ë©‹ì§„ ê²ƒì„ ë§Œë“¤ì–´ë³´ê³  ì‹¶ë‹¤ë©´ ì–¸ì œë“  ì—°ë½ì£¼ì„¸ìš”.
            </p>
            <a href="mailto:janghongseo@naver.com" class="px-10 py-5 bg-white text-black text-lg font-bold rounded-full hover:scale-105 hover:shadow-[0_0_30px_rgba(255,255,255,0.3)] transition duration-300">
                Say Hello ğŸ‘‹
            </a>
        </section>

        <Footer />

        <!-- Terminal Widget -->
        <div id="terminal-widget" data-profile-name={profileConfig.name} class="fixed bottom-8 right-8 z-50 transition-all duration-300 transform translate-y-0">
            <!-- Minimized State (Icon) -->
            <button id="terminal-toggle" class="w-14 h-14 bg-black border border-white/20 rounded-full flex items-center justify-center shadow-[0_0_20px_rgba(0,0,0,0.5)] hover:scale-110 hover:border-[var(--primary)] transition group overflow-hidden">
                <Icon name="mdi:console" class="text-2xl text-white/70 group-hover:text-[var(--primary)] transition" />
            </button>

            <!-- Maximized State (Window) -->
            <div id="terminal-window" class="hidden absolute bottom-0 right-0 w-[90vw] max-w-[500px] h-[400px] bg-[#0a0a0a]/95 backdrop-blur-md border border-white/10 rounded-xl shadow-2xl flex flex-col overflow-hidden origin-bottom-right transition-all duration-300 scale-0 opacity-0">
                <!-- Header -->
                <div class="h-8 bg-white/5 border-b border-white/5 flex items-center px-4 justify-between shrink-0 cursor-move" id="terminal-header">
                    <div class="flex gap-2">
                        <div class="w-3 h-3 rounded-full bg-red-500/80 hover:bg-red-500 cursor-pointer" id="terminal-close"></div>
                        <div class="w-3 h-3 rounded-full bg-yellow-500/80 hover:bg-yellow-500 cursor-pointer" id="terminal-minimize"></div>
                        <div class="w-3 h-3 rounded-full bg-green-500/80 hover:bg-green-500 cursor-pointer"></div>
                    </div>
                    <div class="text-xs text-white/30 font-mono">guest@portfolio:~</div>
                    <div class="w-10"></div> <!-- Spacer for centering -->
                </div>
                
                <!-- Body -->
                <div class="flex-1 p-4 font-mono text-sm overflow-y-auto custom-scrollbar" id="terminal-body" onclick="document.getElementById('terminal-input').focus()">
                    <div id="terminal-output" class="text-white/80 space-y-1 mb-2">
                        <div class="text-[var(--primary)]">Welcome to Portfolio Terminal v1.0.0</div>
                        <div>Type <span class="text-yellow-400">'help'</span> to see available commands.</div>
                        <br/>
                    </div>
                    <div class="flex items-center gap-2 text-white">
                        <span class="text-green-400">âœ</span>
                        <span class="text-cyan-400">~</span>
                        <input type="text" id="terminal-input" class="bg-transparent border-none outline-none flex-1 text-white font-mono p-0 focus:ring-0" autocomplete="off" spellcheck="false" />
                    </div>
                </div>
            </div>
        </div>

        <!-- Project Modal -->
        <div id="skill-modal" class="fixed inset-0 z-[100] hidden opacity-0 transition-opacity duration-300" aria-labelledby="modal-title" role="dialog" aria-modal="true">
            <!-- Backdrop -->
            <div class="absolute inset-0 bg-black/80 backdrop-blur-sm transition-opacity" id="modal-backdrop"></div>

            <div class="relative z-10 flex min-h-full items-center justify-center p-4 text-center sm:p-0">
                <div class="relative transform overflow-hidden rounded-2xl bg-[#0a0a0a] border border-white/10 text-left shadow-2xl transition-all sm:my-8 sm:w-full sm:max-w-4xl">
                    
                    <!-- Close Button (Global) -->
                    <button type="button" id="modal-close-btn" class="absolute top-4 right-4 z-50 p-2 rounded-full bg-black/50 text-white/80 hover:bg-white hover:text-black transition-all duration-300 backdrop-blur-sm group">
                        <Icon name="mdi:close" class="w-6 h-6 transition-transform group-hover:rotate-90" />
                    </button>

                    <!-- View 1: Project List -->
                    <div id="modal-view-list" class="transition-all duration-300">
                        <div class="px-4 pb-4 pt-5 sm:p-6 sm:pb-4">
                            <div class="sm:flex sm:items-start">
                                <div class="mt-3 text-center sm:ml-4 sm:mt-0 sm:text-left w-full">
                                    <h3 class="text-2xl font-bold leading-6 text-white mb-6 flex items-center gap-3 pr-12" id="modal-title">
                                        <span id="modal-icon" class="text-3xl"></span>
                                        <span id="modal-skill-name">Skill Name</span>
                                        <span class="text-sm font-normal text-white/40 ml-auto hidden sm:inline">Projects using this skill</span>
                                    </h3>
                                    
                                    <div id="modal-projects-list" class="mt-2 space-y-4 max-h-[60vh] overflow-y-auto pr-2 custom-scrollbar">
                                        <!-- Projects will be injected here -->
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- Bottom footer removed as close button is now global -->
                    </div>

                    <!-- View 2: Project Detail -->
                    <div id="modal-view-detail" class="hidden transition-all duration-300 max-h-[85vh] overflow-y-auto custom-scrollbar">
                        <div class="relative">
                            <!-- Carousel Container -->
                            <div class="aspect-video w-full bg-black relative shrink-0 group overflow-hidden" id="detail-media-container">
                                <!-- Carousel Track -->
                                <div id="carousel-track" class="flex h-full transition-transform duration-500 ease-in-out">
                                    <!-- Media items injected here -->
                                </div>
                                
                                <!-- Navigation Buttons -->
                                <button id="carousel-prev" class="absolute left-4 top-1/2 -translate-y-1/2 w-10 h-10 rounded-full bg-black/50 text-white flex items-center justify-center hover:bg-black/80 transition opacity-0 group-hover:opacity-100 disabled:opacity-0 z-10">
                                    â†
                                </button>
                                <button id="carousel-next" class="absolute right-4 top-1/2 -translate-y-1/2 w-10 h-10 rounded-full bg-black/50 text-white flex items-center justify-center hover:bg-black/80 transition opacity-0 group-hover:opacity-100 disabled:opacity-0 z-10">
                                    â†’
                                </button>
                                
                                <!-- Dots -->
                                <div id="carousel-dots" class="absolute bottom-4 left-1/2 -translate-x-1/2 flex gap-2 z-10">
                                    <!-- Dots injected here -->
                                </div>
                            </div>
                            
                            <div class="px-6 py-6">
                                <button type="button" id="detail-back-btn" class="mb-4 text-sm text-white/60 hover:text-white flex items-center gap-1 transition">
                                    <span>â†</span> Back to list
                                </button>
                                
                                <h2 class="text-3xl font-bold text-white mb-2" id="detail-title">Project Title</h2>
                                
                                <div class="flex flex-wrap gap-2 mb-6" id="detail-tags">
                                    <!-- Tags injected here -->
                                </div>
                                
                                <p class="text-white/80 leading-relaxed mb-8 text-lg whitespace-pre-line" id="detail-description">
                                    Project description goes here.
                                </p>
                                
                                <div class="flex gap-4 pt-4">
                                    <a href="#" target="_blank" id="detail-demo-link" class="flex-1 group relative overflow-hidden rounded-xl bg-gradient-to-r from-violet-600 to-indigo-600 p-[1px] transition-all duration-300 hover:shadow-[0_0_20px_rgba(124,58,237,0.5)] hover:-translate-y-1">
                                        <div class="relative h-full w-full bg-black/20 backdrop-blur-sm transition-all group-hover:bg-transparent rounded-xl flex items-center justify-center gap-2 px-6 py-3.5 text-white font-bold">
                                            <Icon name="mdi:rocket-launch" class="w-5 h-5 transition-transform group-hover:rotate-12" />
                                            <span>Live Demo</span>
                                        </div>
                                    </a>
                                    
                                    <a href="#" target="_blank" id="detail-repo-link" class="flex-1 group relative overflow-hidden rounded-xl bg-white/10 p-[1px] transition-all duration-300 hover:bg-white/20 hover:shadow-[0_0_20px_rgba(255,255,255,0.1)] hover:-translate-y-1">
                                        <div class="relative h-full w-full flex items-center justify-center gap-2 px-6 py-3.5 text-white font-bold">
                                            <Icon name="mdi:github" class="w-5 h-5 transition-transform group-hover:scale-110" />
                                            <span>GitHub Repo</span>
                                        </div>
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
            </div>
        </div>

    </div>
</Layout>

<script is:inline define:vars={{ projects }}>
    const modal = document.getElementById('skill-modal');
    const modalBackdrop = document.getElementById('modal-backdrop');
    const modalCloseBtn = document.getElementById('modal-close-btn');
    
    // View 1 Elements
    const viewList = document.getElementById('modal-view-list');
    const modalTitle = document.getElementById('modal-skill-name');
    const modalIcon = document.getElementById('modal-icon');
    const modalList = document.getElementById('modal-projects-list');
    
    // View 2 Elements
    const viewDetail = document.getElementById('modal-view-detail');
    const detailBackBtn = document.getElementById('detail-back-btn');
    const detailMedia = document.getElementById('detail-media-container');
    const carouselTrack = document.getElementById('carousel-track');
    const detailTitle = document.getElementById('detail-title');
    const detailDesc = document.getElementById('detail-description');
    const detailTags = document.getElementById('detail-tags');
    const detailDemo = document.getElementById('detail-demo-link');
    const detailRepo = document.getElementById('detail-repo-link');
    
    // Carousel Elements
    const prevBtn = document.getElementById('carousel-prev');
    const nextBtn = document.getElementById('carousel-next');
    const dotsContainer = document.getElementById('carousel-dots');
    
    let currentProject = null;
    let currentMediaIndex = 0; // Visual index (0 to length-1)
    let currentTrackIndex = 1; // Track index (including clones, starts at 1)
    let isTransitioning = false;

    const projectCards = document.querySelectorAll('.project-card-trigger');



    function showDetailView(project) {
        if (!modal) return;

        currentProject = project;
        currentMediaIndex = 0;
        currentTrackIndex = 1;
        isTransitioning = false;
        
        // Populate Details
        detailTitle.textContent = project.title;
        // Use detailDescription if available, otherwise fallback to description
        detailDesc.textContent = project.detailDescription || project.description;
        
        // Tags
        detailTags.innerHTML = project.tags.map(tag => 
            `<span class="px-3 py-1 text-xs font-bold uppercase tracking-wider bg-white/10 rounded-full text-white/90">${tag}</span>`
        ).join('');

        // Links
        if (project.demoUrl) {
            detailDemo.href = project.demoUrl;
            detailDemo.classList.remove('hidden');
        } else {
            detailDemo.classList.add('hidden');
        }
        
        if (project.repoUrl) {
            detailRepo.href = project.repoUrl;
            detailRepo.classList.remove('hidden');
        } else {
            detailRepo.classList.add('hidden');
        }

        // Initialize Carousel
        initCarousel();

        // Switch Views (Always show detail, hide list)
        viewList.classList.add('hidden');
        viewDetail.classList.remove('hidden');
        
        // Hide Back Button since we are opening directly
        if (detailBackBtn) detailBackBtn.classList.add('hidden');

        // Show Modal
        modal.classList.remove('hidden');
        setTimeout(() => {
            modal.classList.remove('opacity-0');
            modal.querySelector('div[class*="transform"]').classList.remove('scale-100');
            modal.querySelector('div[class*="transform"]').classList.add('scale-100');
        }, 10);
        document.body.style.overflow = 'hidden';
    }
    
    function createSlide(media) {
        const slide = document.createElement('div');
        slide.className = 'w-full h-full shrink-0 flex items-center justify-center bg-black';
        
        let mediaHtml = '';
        if (media.type === 'video') {
            const videoUrl = media.url.toLowerCase();
            if (videoUrl.endsWith('.mp4') || videoUrl.endsWith('.webm')) {
                mediaHtml = `
                    <video 
                        src="${media.url}" 
                        class="w-full h-full object-contain" 
                        controls 
                        playsinline>
                        Your browser does not support the video tag.
                    </video>
                `;
            } else if (videoUrl.endsWith('.gif')) {
                mediaHtml = `
                    <img src="${media.url}" alt="Project Demo" class="w-full h-full object-contain" />
                `;
            } else {
                // Iframe
                mediaHtml = `
                    <iframe 
                        src="${media.url}" 
                        class="w-full h-full" 
                        frameborder="0" 
                        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
                        allowfullscreen>
                    </iframe>
                `;
            }
        } else {
            mediaHtml = `
                <img src="${media.url}" alt="Project Image" class="w-full h-full object-contain" />
            `;
        }
        
        slide.innerHTML = mediaHtml;
        return slide;
    }

    function initCarousel() {
        if (!currentProject) return;
        
        // Determine media list
        let mediaList = [];
        if (currentProject.media && currentProject.media.length > 0) {
            mediaList = currentProject.media;
        } else if (currentProject.video) {
            mediaList = [{ type: 'video', url: currentProject.video }];
        } else {
            mediaList = [{ type: 'image', url: currentProject.image }];
        }
        
        // Clear track
        carouselTrack.innerHTML = '';
        
        // If only 1 item, no clones needed
        if (mediaList.length <= 1) {
            const slide = createSlide(mediaList[0]);
            carouselTrack.appendChild(slide);
            updateButtons(1);
            carouselTrack.style.transform = 'translateX(0)';
            return;
        }

        // Clone Last Slide (Prepend)
        const lastClone = createSlide(mediaList[mediaList.length - 1]);
        lastClone.id = 'last-clone';
        carouselTrack.appendChild(lastClone);

        // Render Real Slides
        mediaList.forEach(media => {
            const slide = createSlide(media);
            carouselTrack.appendChild(slide);
        });

        // Clone First Slide (Append)
        const firstClone = createSlide(mediaList[0]);
        firstClone.id = 'first-clone';
        carouselTrack.appendChild(firstClone);
        
        // Initial Position (show first real slide)
        carouselTrack.style.transition = 'none';
        carouselTrack.style.transform = `translateX(-100%)`;
        currentTrackIndex = 1;
        currentMediaIndex = 0;
        
        updateButtons(mediaList.length);
        
        // Handle Transition End for Infinite Loop
        carouselTrack.addEventListener('transitionend', () => {
            isTransitioning = false;
            const slides = carouselTrack.children;
            
            if (slides[currentTrackIndex].id === 'last-clone') {
                carouselTrack.style.transition = 'none';
                currentTrackIndex = slides.length - 2;
                carouselTrack.style.transform = `translateX(-${currentTrackIndex * 100}%)`;
            }
            if (slides[currentTrackIndex].id === 'first-clone') {
                carouselTrack.style.transition = 'none';
                currentTrackIndex = 1;
                carouselTrack.style.transform = `translateX(-${currentTrackIndex * 100}%)`;
            }
        });
    }
    
    function updateButtons(totalSlides) {
        // Update Dots
        if (totalSlides > 1) {
            prevBtn.classList.remove('hidden');
            nextBtn.classList.remove('hidden');
            dotsContainer.classList.remove('hidden');
            
            // Render Dots
            dotsContainer.innerHTML = Array.from({ length: totalSlides }).map((_, idx) => `
                <button class="w-2 h-2 rounded-full transition-all ${idx === currentMediaIndex ? 'bg-white w-4' : 'bg-white/50 hover:bg-white/80'}" onclick="goToSlide(${idx})"></button>
            `).join('');
        } else {
            prevBtn.classList.add('hidden');
            nextBtn.classList.add('hidden');
            dotsContainer.classList.add('hidden');
        }
        
        // Pause videos in other slides
        const slides = carouselTrack.children;
        Array.from(slides).forEach((slide, idx) => {
            // Be careful with clones, we might have multiple instances of the same video
            // Just pause everything that is NOT the current track index
            if (idx !== currentTrackIndex) {
                const video = slide.querySelector('video');
                const iframe = slide.querySelector('iframe');
                if (video) video.pause();
                if (iframe) {
                    const src = iframe.src;
                    iframe.src = src; 
                }
            }
        });
    }
    
    window.goToSlide = (index) => {
        if (isTransitioning) return;
        
        // Calculate target track index
        // Real slides start at index 1
        currentTrackIndex = index + 1;
        currentMediaIndex = index;
        
        carouselTrack.style.transition = 'transform 0.5s ease-in-out';
        carouselTrack.style.transform = `translateX(-${currentTrackIndex * 100}%)`;
        isTransitioning = true;
        
        // Determine total slides for dots update
        // Total children = totalSlides + 2 (clones)
        const totalSlides = carouselTrack.children.length - 2;
        updateButtons(totalSlides);
    };

    function nextSlide() {
        if (isTransitioning) return;
        const totalChildren = carouselTrack.children.length;
        if (totalChildren <= 1) return; // No clones, single item
        
        currentTrackIndex++;
        carouselTrack.style.transition = 'transform 0.5s ease-in-out';
        carouselTrack.style.transform = `translateX(-${currentTrackIndex * 100}%)`;
        isTransitioning = true;
        
        // Update visual index
        const totalSlides = totalChildren - 2;
        currentMediaIndex = (currentMediaIndex + 1) % totalSlides;
        updateButtons(totalSlides);
    }

    function prevSlide() {
        if (isTransitioning) return;
        const totalChildren = carouselTrack.children.length;
        if (totalChildren <= 1) return;
        
        currentTrackIndex--;
        carouselTrack.style.transition = 'transform 0.5s ease-in-out';
        carouselTrack.style.transform = `translateX(-${currentTrackIndex * 100}%)`;
        isTransitioning = true;
        
        // Update visual index
        const totalSlides = totalChildren - 2;
        currentMediaIndex = (currentMediaIndex - 1 + totalSlides) % totalSlides;
        updateButtons(totalSlides);
    }

    function showListView() {
        // Stop all videos
        const videos = carouselTrack.querySelectorAll('video');
        videos.forEach(v => v.pause());
        const iframes = carouselTrack.querySelectorAll('iframe');
        iframes.forEach(i => { i.src = i.src; }); // Reset to stop
        
        viewDetail.classList.add('hidden');
        viewList.classList.remove('hidden');
    }

    function closeModal() {
        if (!modal) return;
        modal.classList.add('opacity-0');
        modal.querySelector('div[class*="transform"]').classList.remove('scale-100');
        modal.querySelector('div[class*="transform"]').classList.add('scale-95');
        
        // Stop video when closing
        setTimeout(() => {
            // Clear track to stop everything
            carouselTrack.innerHTML = '';
            
            modal.classList.add('hidden');
            document.body.style.overflow = '';
        }, 300);
    }

    projectCards.forEach(card => {
        card.addEventListener('click', () => {
            const project = JSON.parse(card.dataset.project);
            showDetailView(project);
        });
    });

    modalBackdrop?.addEventListener('click', closeModal);
    modalCloseBtn?.addEventListener('click', closeModal);
    detailBackBtn?.addEventListener('click', showListView);
    
    prevBtn?.addEventListener('click', prevSlide);
    nextBtn?.addEventListener('click', nextSlide);
    
    document.addEventListener('keydown', (e) => {
        if (modal.classList.contains('hidden')) return;
        
        if (e.key === 'Escape') {
            closeModal();
        } else if (e.key === 'ArrowRight') {
            nextSlide();
        } else if (e.key === 'ArrowLeft') {
            prevSlide();
        }
    });

    // Typing Animation
    const typingText = document.getElementById('typing-text');
    const words = ["SCALABLE", "AUTOMATED", "ROBUST", "EFFICIENT"];
    let wordIndex = 0;
    let charIndex = words[0].length; // Start with full word
    let isDeleting = true; // Start by deleting after delay
    let typeSpeed = 100;

    function type() {
        if (!typingText) return;

        const currentWord = words[wordIndex];
        
        if (isDeleting) {
            typingText.textContent = currentWord.substring(0, charIndex - 1);
            charIndex--;
            typeSpeed = 50;
        } else {
            typingText.textContent = currentWord.substring(0, charIndex + 1);
            charIndex++;
            typeSpeed = 150;
        }

        if (!isDeleting && charIndex === currentWord.length) {
            isDeleting = true;
            typeSpeed = 2000; // Pause at end
        } else if (isDeleting && charIndex === 0) {
            isDeleting = false;
            wordIndex = (wordIndex + 1) % words.length;
            typeSpeed = 500; // Pause before typing new word
        }

        setTimeout(type, typeSpeed);
    }

    // Start typing loop after initial delay
    setTimeout(type, 2000);
    // Terminal Widget Logic
    const terminalWidget = document.getElementById('terminal-widget');
    const terminalToggle = document.getElementById('terminal-toggle');
    const terminalWindow = document.getElementById('terminal-window');
    const terminalClose = document.getElementById('terminal-close');
    const terminalMinimize = document.getElementById('terminal-minimize');
    const terminalBody = document.getElementById('terminal-body');
    const terminalOutput = document.getElementById('terminal-output');
    const terminalInput = document.getElementById('terminal-input');

    let isTerminalOpen = false;

    function toggleTerminal() {
        isTerminalOpen = !isTerminalOpen;
        if (isTerminalOpen) {
            terminalToggle.classList.add('hidden');
            terminalWindow.classList.remove('hidden');
            // Small delay to allow display:block to apply before transition
            setTimeout(() => {
                terminalWindow.classList.remove('scale-0', 'opacity-0');
                terminalInput.focus();
            }, 10);
        } else {
            terminalWindow.classList.add('scale-0', 'opacity-0');
            setTimeout(() => {
                terminalWindow.classList.add('hidden');
                terminalToggle.classList.remove('hidden');
            }, 300);
        }
    }

    terminalToggle?.addEventListener('click', toggleTerminal);
    terminalClose?.addEventListener('click', toggleTerminal);
    terminalMinimize?.addEventListener('click', toggleTerminal);

    const commands = {
        help: () => `
            <div class="grid grid-cols-[100px_1fr] gap-2 text-white/70">
                <span class="text-yellow-400">whoami</span> <span>About me</span>
                <span class="text-yellow-400">skills</span> <span>My technical skills</span>
                <span class="text-yellow-400">contact</span> <span>Contact info</span>
                <span class="text-yellow-400">clear</span> <span>Clear terminal</span>
                <span class="text-yellow-400">exit</span> <span>Close terminal</span>
            </div>
        `,
        whoami: () => {
            const profileName = terminalWidget.dataset.profileName;
            return `
            <div>
                Hello! I'm <span class="text-[var(--primary)] font-bold">${profileName}</span>.<br/>
                I am an MLOps Engineer passionate about building scalable and automated machine learning systems.
            </div>
        `},
        skills: () => `
            <div class="space-y-1">
                <div class="text-[var(--primary)] font-bold">Infrastructure & DevOps</div>
                <div>Kubernetes, Docker, Terraform, AWS, GCP</div>
                <div class="text-[var(--primary)] font-bold mt-2">MLOps & Data</div>
                <div>Kubeflow, MLflow, Airflow, Prometheus, Grafana</div>
                <div class="text-[var(--primary)] font-bold mt-2">Languages</div>
                <div>Python, Go, SQL, TypeScript</div>
            </div>
        `,
        contact: () => `
            <div>
                <div>ğŸ“§ <a href="mailto:janghongseo@example.com" class="underline hover:text-white">janghongseo@naver.com</a></div>
                <div>ğŸ™ <a href="https://github.com/pxxguin" target="_blank" class="underline hover:text-white">GitHub</a></div>
                <div>ğŸ”— <a href="https://www.linkedin.com/in/hongseojang/" target="_blank" class="underline hover:text-white">LinkedIn</a></div>
            </div>
        `,
        exit: () => {
            toggleTerminal();
            return 'Closing terminal...';
        }
    };

    terminalInput?.addEventListener('keydown', (e) => {
        if (e.key === 'Enter') {
            const input = terminalInput.value.trim();
            if (!input) return;

            // Add command to history
            const cmdLine = document.createElement('div');
            cmdLine.className = 'flex items-center gap-2 text-white mb-1';
            cmdLine.innerHTML = `<span class="text-green-400">âœ</span> <span class="text-cyan-400">~</span> ${input}`;
            terminalOutput.appendChild(cmdLine);

            // Process command
            const cmd = input.toLowerCase();
            let response = '';

            if (cmd === 'clear') {
                terminalOutput.innerHTML = '';
            } else if (commands[cmd]) {
                response = commands[cmd]();
            } else {
                response = `<span class="text-red-400">Command not found: ${cmd}. Type 'help' for available commands.</span>`;
            }

            if (response && cmd !== 'clear') {
                const respDiv = document.createElement('div');
                respDiv.className = 'mb-4 text-white/80 leading-relaxed';
                respDiv.innerHTML = response;
                terminalOutput.appendChild(respDiv);
            }

            terminalInput.value = '';
            terminalBody.scrollTop = terminalBody.scrollHeight;
        }
    });
</script>

<style>
    .animate-fade-in-up {
        animation: fadeInUp 1s ease-out forwards;
        opacity: 0;
        transform: translateY(30px);
    }
    
    .delay-100 { animation-delay: 0.1s; }
    .delay-200 { animation-delay: 0.2s; }

    @keyframes fadeInUp {
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    .custom-scrollbar::-webkit-scrollbar {
        width: 8px;
    }
    .custom-scrollbar::-webkit-scrollbar-track {
        background: rgba(255, 255, 255, 0.05);
        border-radius: 4px;
    }
    .custom-scrollbar::-webkit-scrollbar-thumb {
        background: rgba(255, 255, 255, 0.2);
        border-radius: 4px;
    }
    .custom-scrollbar::-webkit-scrollbar-thumb:hover {
        background: rgba(255, 255, 255, 0.3);
    }

    .animate-blink {
        animation: blink 1s step-end infinite;
    }
    @keyframes blink {
        0%, 100% { opacity: 1; }
        50% { opacity: 0; }
    }
</style>
